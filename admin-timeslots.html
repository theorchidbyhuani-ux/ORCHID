<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Manage Timeslots | The Orchid</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Playfair Display', Arial, sans-serif;
            background: #f9f4f7;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(255,101,163,0.1);
            padding: 40px;
        }
        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #ffe6f3;
        }
        .admin-title {
            font-size: 2.5rem;
            color: #ff65a3;
            margin-bottom: 10px;
        }
        .admin-subtitle {
            font-size: 1.2rem;
            color: #666;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #ff65a3;
            text-decoration: none;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .back-link:hover {
            opacity: 0.7;
        }
        .controls-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #fff0f6;
            border-radius: 12px;
            border: 1px solid #ffe0ef;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1rem;
        }
        .control-input {
            width: 100%;
            max-width: 300px;
            padding: 10px 12px;
            border: 1px solid #eee;
            border-radius: 7px;
            font-size: 1rem;
            background: #fff;
            transition: border 0.2s;
            font-family: 'Playfair Display', Arial, sans-serif;
        }
        .control-input:focus {
            border: 1.5px solid #ff65a3;
            outline: none;
        }
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #ff7eb3, #ff65a3);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(255,101,163,0.4);
            font-family: 'Playfair Display', Arial, sans-serif;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(255,101,163,0.5);
        }
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .btn-secondary:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .timeslots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .date-section {
            background: #fff;
            border: 1px solid #ffe0ef;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(255,101,163,0.08);
        }
        .date-header {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ff65a3;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ffe0ef;
        }
        .timeslot-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f9f6fa;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .timeslot-item:hover {
            background: #ffe6f3;
        }
        .timeslot-time {
            font-weight: 600;
            color: #333;
        }
        .timeslot-status {
            font-size: 0.9rem;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
        }
        .status-available {
            background: #d4f4dd;
            color: #1b8838;
        }
        .status-blocked {
            background: #ffd4d4;
            color: #d32f2f;
        }
        .remove-btn {
            background: none;
            border: none;
            color: #ff65a3;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 4px 8px;
            transition: color 0.2s;
            font-family: 'Playfair Display', Arial, sans-serif;
        }
        .remove-btn:hover {
            color: #ff3366;
        }
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        .message-success {
            background: #d4f4dd;
            color: #1b8838;
            border: 1px solid #a8e6b8;
        }
        .message-error {
            background: #ffd4d4;
            color: #d32f2f;
            border: 1px solid #ffb3b3;
        }
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #fff0f6 0%, #ffe6f3 100%);
            border: 1px solid #ffe0ef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ff65a3;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 1.1rem;
            color: #666;
        }
        .no-slots {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 40px;
        }
        @media (max-width: 768px) {
            .admin-container {
                padding: 20px;
            }
            .admin-title {
                font-size: 2rem;
            }
            .timeslots-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <a href="index.html" class="back-link">← Back to Website</a>
        
        <div class="admin-header">
            <h1 class="admin-title">Timeslot Management</h1>
            <p class="admin-subtitle">Manage blocked timeslots for The Orchid booking system</p>
        </div>

        <div id="messageArea"></div>

        <div class="stats-section" id="statsSection">
            <div class="stat-card">
                <div class="stat-number" id="totalBlocked">0</div>
                <div class="stat-label">Total Blocked Slots</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayBlocked">0</div>
                <div class="stat-label">Blocked Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="upcomingBlocked">0</div>
                <div class="stat-label">Upcoming Blocked</div>
            </div>
        </div>

        <div class="controls-section">
            <h2 style="font-size: 1.5rem; color: #ff65a3; margin-bottom: 20px;">Add Blocked Timeslot</h2>
            
            <div class="control-group">
                <label class="control-label" for="blockDate">Date</label>
                <input type="date" id="blockDate" class="control-input" min="">
            </div>
            
            <div class="control-group">
                <label class="control-label" for="blockTime">Time</label>
                <select id="blockTime" class="control-input">
                    <option value="">Select Time</option>
                </select>
            </div>
            
            <div class="control-group">
                <label class="control-label" for="blockReason">Reason (Optional)</label>
                <input type="text" id="blockReason" class="control-input" placeholder="e.g., Staff meeting, Holiday">
            </div>
            
            <button class="btn" onclick="addBlockedSlot()">Block Timeslot</button>
            <button class="btn btn-secondary" onclick="clearAllBlocked()">Clear All Blocked</button>
            <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
        </div>

        <h2 style="font-size: 1.8rem; color: #ff65a3; margin-bottom: 20px; text-align: center;">Blocked Timeslots</h2>
        
        <div class="timeslots-grid" id="timeslotsGrid">
            <div class="no-slots">No blocked timeslots yet.</div>
        </div>
    </div>

    <script>
        // Initialize blocked slots from localStorage
        let blockedSlots = JSON.parse(localStorage.getItem('orchidBlockedSlots') || '{}');

        // Set min date to today
        function setMinDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('blockDate').min = `${yyyy}-${mm}-${dd}`;
        }

        // Populate time slots
        function populateTimeSlots() {
            const timeSelect = document.getElementById('blockTime');
            timeSelect.innerHTML = '<option value="">Select Time</option>';
            
            for (let h = 10; h <= 21; h++) {
                for (let m = 0; m < 60; m += 30) {
                    if (h === 21 && m > 0) continue;
                    let hour = h < 10 ? '0' + h : h;
                    let min = m === 0 ? '00' : '30';
                    let ampm = h < 12 ? 'AM' : 'PM';
                    let displayHour = h > 12 ? h - 12 : h;
                    if (displayHour === 0) displayHour = 12;
                    let label = `${displayHour}:${min} ${ampm}`;
                    let value = `${hour}:${min}`;
                    timeSelect.innerHTML += `<option value="${value}">${label}</option>`;
                }
            }
        }

        // Show message
        function showMessage(text, type = 'success') {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="message message-${type}">${text}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 3000);
        }

        // Add blocked slot
        function addBlockedSlot() {
            const date = document.getElementById('blockDate').value;
            const time = document.getElementById('blockTime').value;
            const reason = document.getElementById('blockReason').value;

            if (!date || !time) {
                showMessage('Please select both date and time', 'error');
                return;
            }

            if (!blockedSlots[date]) {
                blockedSlots[date] = {};
            }

            blockedSlots[date][time] = {
                blocked: true,
                reason: reason || 'Blocked',
                addedAt: new Date().toISOString()
            };

            localStorage.setItem('orchidBlockedSlots', JSON.stringify(blockedSlots));
            
            // Clear form
            document.getElementById('blockTime').value = '';
            document.getElementById('blockReason').value = '';
            
            showMessage('Timeslot blocked successfully');
            updateDisplay();
        }

        // Remove blocked slot
        function removeBlockedSlot(date, time) {
            if (blockedSlots[date] && blockedSlots[date][time]) {
                delete blockedSlots[date][time];
                
                // Remove date if no more slots
                if (Object.keys(blockedSlots[date]).length === 0) {
                    delete blockedSlots[date];
                }
                
                localStorage.setItem('orchidBlockedSlots', JSON.stringify(blockedSlots));
                showMessage('Timeslot unblocked successfully');
                updateDisplay();
            }
        }

        // Clear all blocked slots
        function clearAllBlocked() {
            if (confirm('Are you sure you want to clear all blocked timeslots?')) {
                blockedSlots = {};
                localStorage.setItem('orchidBlockedSlots', JSON.stringify(blockedSlots));
                showMessage('All blocked timeslots cleared');
                updateDisplay();
            }
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(blockedSlots, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `orchid-blocked-slots-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showMessage('Data exported successfully');
        }

        // Format time for display
        function formatTime(time) {
            const [h, m] = time.split(':');
            const hour = parseInt(h);
            const ampm = hour < 12 ? 'AM' : 'PM';
            const displayHour = hour > 12 ? hour - 12 : hour;
            return `${displayHour}:${m} ${ampm}`;
        }

        // Format date for display
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Update stats
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            let totalCount = 0;
            let todayCount = 0;
            let upcomingCount = 0;

            Object.keys(blockedSlots).forEach(date => {
                const slotCount = Object.keys(blockedSlots[date]).length;
                totalCount += slotCount;
                
                if (date === today) {
                    todayCount = slotCount;
                } else if (date > today) {
                    upcomingCount += slotCount;
                }
            });

            document.getElementById('totalBlocked').textContent = totalCount;
            document.getElementById('todayBlocked').textContent = todayCount;
            document.getElementById('upcomingBlocked').textContent = upcomingCount;
        }

        // Update display
        function updateDisplay() {
            updateStats();
            
            const grid = document.getElementById('timeslotsGrid');
            const sortedDates = Object.keys(blockedSlots).sort();
            
            if (sortedDates.length === 0) {
                grid.innerHTML = '<div class="no-slots">No blocked timeslots yet.</div>';
                return;
            }

            grid.innerHTML = '';
            
            sortedDates.forEach(date => {
                const dateSection = document.createElement('div');
                dateSection.className = 'date-section';
                
                const dateHeader = document.createElement('div');
                dateHeader.className = 'date-header';
                dateHeader.textContent = formatDate(date);
                dateSection.appendChild(dateHeader);
                
                const sortedTimes = Object.keys(blockedSlots[date]).sort();
                
                sortedTimes.forEach(time => {
                    const slot = blockedSlots[date][time];
                    const slotItem = document.createElement('div');
                    slotItem.className = 'timeslot-item';
                    
                    slotItem.innerHTML = `
                        <div>
                            <div class="timeslot-time">${formatTime(time)}</div>
                            <div style="font-size: 0.85rem; color: #666; margin-top: 2px;">${slot.reason}</div>
                        </div>
                        <button class="remove-btn" onclick="removeBlockedSlot('${date}', '${time}')" title="Unblock">×</button>
                    `;
                    
                    dateSection.appendChild(slotItem);
                });
                
                grid.appendChild(dateSection);
            });
        }

        // Clean up old dates on load
        function cleanupOldDates() {
            const today = new Date().toISOString().split('T')[0];
            let cleaned = false;
            
            Object.keys(blockedSlots).forEach(date => {
                if (date < today) {
                    delete blockedSlots[date];
                    cleaned = true;
                }
            });
            
            if (cleaned) {
                localStorage.setItem('orchidBlockedSlots', JSON.stringify(blockedSlots));
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setMinDate();
            populateTimeSlots();
            cleanupOldDates();
            updateDisplay();
        });
    </script>
</body>
</html> 